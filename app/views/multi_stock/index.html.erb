<div class="max-w-3xl mx-auto mt-8 px-4">
  <div class="flex justify-between gap-2 mb-4">
    <h1 class="flex items-center text-2xl font-semibold text-gray-800">Multi Stock Averaging Down Strategy</h1>
    <div class="flex flex-wrap gap-2 items-center justify-start">
      <%= link_to 'Back', root_path, class: 'inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition' %>
    </div>
  </div>

  <% if flash[:alert] %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
      <span class="block sm:inline"><%= flash[:alert] %></span>
    </div>
  <% end %>

  <%= form_with url: backtest_multi_stock_index_path, method: :post, model: @multi_stock, class: 'grid grid-cols-1 md:grid-cols-2 border border-gray-300 gap-6 bg-white p-6 rounded-lg shadow-2xl' do |f| %>

    <div>
      <%= f.label :start_date, 'Start Date', class: 'block text-sm font-medium text-gray-700 mb-1' %>
      <%= f.date_field :start_date, class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500', required: true %>
    </div>

    <div>
      <%= f.label :end_date, 'End Date (optional)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
      <%= f.date_field :end_date, class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>

    <div>
      <div class="flex items-center mb-1">
        <%= f.label :investment_amount, 'Investment Amount (₹)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "invest-tip", message: "Set the initial investment amount to start investing." %>
      </div>
      <%= f.number_field :investment_amount, step: 1000, min: 0, required: true,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>

    <div>
      <div class="flex items-center mb-1">
        <%= f.label :maximum_buy_amount, 'Maximum Buy Amount (₹)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "max-buy-tip", message: "Set the maximum buy amount at the time of averaging." %>
      </div>
      <%= f.number_field :maximum_buy_amount, value: 10000, step: 5000, min: 0,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>

    <div>
      <div class="flex items-center mb-1">
        <%= f.label :sell_profit_percentage, 'Sell Profit (%)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "profit-tip", message: "Set the profit percentage to exit from the stock." %>
      </div>
      <%= f.number_field :sell_profit_percentage, step: 1, min: 0, required: true,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>

    <div>
      <div class="flex items-center mb-1">
        <%= f.label :buy_dip_percentage, 'Buy Dip (%)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "dip-tip", message: "Set the portfolio's percentage for the average." %>
      </div>
      <%= f.number_field :buy_dip_percentage, step: 1, min: 0, required: true,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>
    <div>
      <div class="flex items-center mb-1">
        <%= f.label :reinvestment_percentage, 'Reinvestment (%)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "reinvestment-tip", message: "Set the percentage of your portfolio to invest again to make average." %>
      </div>
      <%= f.number_field :reinvestment_percentage, step: 5, min: 0, required: true,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>
    <div>
      <div class="flex items-center mb-1">
        <%= f.label :total_amount, 'Total Amount (%)', class: 'block text-sm font-medium text-gray-700 mb-1' %>
        <%= render "tooltip", tooltip_id: "total_amount-tip", message: "All the transaction of stocks will be done within the total amount, Once this amount finishes, No transaction will take place, It is suggested to start with 2-3 Lakhs." %>
      </div>
      <%= f.number_field :total_amount, step: 10000, min: 0, required: true,
            class: 'w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
    </div>

    <div data-controller="stock-search">
      <div>
        <div class="flex items-center mb-1">
          <%= f.label :start_date, 'Search & Select Stock', class: 'block text-sm font-medium text-gray-700 mb-1' %>
          <%= render "tooltip", tooltip_id: "stock_search-tip", message: "Search stock and select, You can select as much stock you want, After submit, if waiting message arrives, Please wait for 2-3 minutes, as new stock records would be loaded." %>
        </div>
        <input type="text" name="q" placeholder="select stocks..." 
            data-stock-search-target="input" 
            data-action="input->stock-search#search" 
            class="w-full border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>
      <div>
        <div id="stock-list" data-stock-search-target="results" class="space-y-2">
          <!-- checklist will be injected here -->
        </div>

        <!-- This holds all selected stock symbols -->
        <div id="selected-stocks-container" data-stock-search-target="selectedContainer"></div>
      </div>
    </div>

    <div class="md:col-span-2 text-right">
      <%= f.submit 'Run Backtest', class: 'inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md shadow-sm transition' %>
    </div>

  <% end %>
</div>
